-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public."AIRPORTS"
(
    airport_code text COLLATE pg_catalog."default" NOT NULL,
    country text COLLATE pg_catalog."default" NOT NULL,
    status text COLLATE pg_catalog."default" NOT NULL,
    city text COLLATE pg_catalog."default",
    name text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT "AIRPORTS_pkey" PRIMARY KEY (airport_code),
    CONSTRAINT "AIRPORTS_airport_code_key" UNIQUE (airport_code)
);

CREATE TABLE IF NOT EXISTS public."CASH_REGISTERS"
(
    cash_register_id uuid NOT NULL,
    address text COLLATE pg_catalog."default" NOT NULL,
    status text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT "CASH_REGISTERS_pkey" PRIMARY KEY (cash_register_id),
    CONSTRAINT "CASH_REGISTERS_cash_register_id_key" UNIQUE (cash_register_id)
);

CREATE TABLE IF NOT EXISTS public."COMPANY"
(
    company_id uuid NOT NULL,
    name text COLLATE pg_catalog."default" NOT NULL,
    country text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT "COMPANY_pkey" PRIMARY KEY (company_id),
    CONSTRAINT "COMPANY_company_id_key" UNIQUE (company_id)
);

CREATE TABLE IF NOT EXISTS public."CREW"
(
    crew_id uuid NOT NULL,
    role text COLLATE pg_catalog."default" NOT NULL,
    medical_check_date date NOT NULL,
    medical_status text COLLATE pg_catalog."default" NOT NULL,
    medical_reason text COLLATE pg_catalog."default",
    flight_id uuid,
    member_id uuid,
    CONSTRAINT "CREW_pkey" PRIMARY KEY (crew_id),
    CONSTRAINT "CREW_crew_id_flight_id_key" UNIQUE (crew_id, flight_id)
);

CREATE TABLE IF NOT EXISTS public."CREW_MEMBERS"
(
    member_id uuid NOT NULL,
    company_id uuid NOT NULL,
    full_name text COLLATE pg_catalog."default" NOT NULL,
    email text COLLATE pg_catalog."default" NOT NULL,
    phone_number text COLLATE pg_catalog."default" NOT NULL,
    passport_serial numeric NOT NULL,
    passport_number numeric NOT NULL,
    passport_region text COLLATE pg_catalog."default" NOT NULL,
    role text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT "CREW_MEMBERS_pkey" PRIMARY KEY (member_id),
    CONSTRAINT "CREW_MEMBERS_member_id_key" UNIQUE (member_id)
);

CREATE TABLE IF NOT EXISTS public."FLIGHT"
(
    status text COLLATE pg_catalog."default" NOT NULL,
    flight_id uuid NOT NULL,
    plane_id uuid,
    arrival_time time with time zone NOT NULL,
    arrival_time_fact time with time zone,
    departure_time time with time zone NOT NULL,
    departure_time_fact time with time zone,
    departure_airport text COLLATE pg_catalog."default" NOT NULL,
    destination_airport text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT "FLIGHT_pkey" PRIMARY KEY (flight_id),
    CONSTRAINT "FLIGHT_flight_id_key" UNIQUE (flight_id)
);

CREATE TABLE IF NOT EXISTS public."PASSENGERS"
(
    passenger_id uuid NOT NULL,
    full_name text COLLATE pg_catalog."default" NOT NULL,
    passport_serial integer NOT NULL,
    passport_number integer NOT NULL,
    passport_region text COLLATE pg_catalog."default" NOT NULL,
    birth_date date NOT NULL,
    phone_number numeric NOT NULL,
    email text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT "PASSENGERS_pkey" PRIMARY KEY (passenger_id),
    CONSTRAINT "PASSENGERS_passenger_id_key" UNIQUE (passenger_id)
);

CREATE TABLE IF NOT EXISTS public."PLANES"
(
    plane_id uuid NOT NULL,
    model_id uuid NOT NULL,
    company_id uuid NOT NULL,
    status text COLLATE pg_catalog."default" NOT NULL,
    flight_duration time without time zone NOT NULL,
    last_technical_service timestamp with time zone NOT NULL,
    CONSTRAINT "PLANES_pkey" PRIMARY KEY (plane_id),
    CONSTRAINT "PLANES_plane_id_key" UNIQUE (plane_id)
);

CREATE TABLE IF NOT EXISTS public."PLANE_MODELS"
(
    model_id uuid NOT NULL,
    type text COLLATE pg_catalog."default" NOT NULL,
    seat_count integer NOT NULL,
    speed numeric NOT NULL,
    fuel_consumption numeric NOT NULL,
    cargo_capacity numeric NOT NULL,
    range numeric NOT NULL,
    role text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT "PLANE_MODELS_pkey" PRIMARY KEY (model_id),
    CONSTRAINT "PLANE_MODELS_model_id_key" UNIQUE (model_id)
);

CREATE TABLE IF NOT EXISTS public."SEATS"
(
    seat_id uuid NOT NULL,
    flight_id uuid NOT NULL,
    seat_number text COLLATE pg_catalog."default" NOT NULL,
    seat_type text COLLATE pg_catalog."default" NOT NULL,
    base_price numeric NOT NULL DEFAULT 0,
    is_booked boolean NOT NULL DEFAULT false,
    CONSTRAINT "SEATS_pkey" PRIMARY KEY (seat_id),
    CONSTRAINT "SEATS_seat_id_key" UNIQUE (seat_id)
);

CREATE TABLE IF NOT EXISTS public."TICKETS"
(
    ticket_id uuid NOT NULL,
    flight_id uuid NOT NULL,
    seat_id uuid NOT NULL,
    sale_channel text COLLATE pg_catalog."default" NOT NULL,
    cash_register_id uuid NOT NULL,
    status text COLLATE pg_catalog."default" NOT NULL,
    additional_fee numeric NOT NULL,
    passanger_id uuid NOT NULL,
    CONSTRAINT "TICKETS_pkey" PRIMARY KEY (ticket_id),
    CONSTRAINT "TICKETS_ticket_id_seat_id_key" UNIQUE (ticket_id, seat_id)
);

CREATE TABLE IF NOT EXISTS public."TRANSIT"
(
    arrival_flight_id uuid NOT NULL,
    departure_flight_id uuid NOT NULL,
    transit_id uuid NOT NULL,
    CONSTRAINT "TRANSIT_pkey" PRIMARY KEY (transit_id)
);

ALTER TABLE IF EXISTS public."CREW"
    ADD CONSTRAINT "123" FOREIGN KEY (member_id)
    REFERENCES public."CREW_MEMBERS" (member_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."CREW"
    ADD CONSTRAINT "CREW_flight_id_fkey" FOREIGN KEY (flight_id)
    REFERENCES public."FLIGHT" (flight_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."CREW_MEMBERS"
    ADD CONSTRAINT "CREW_MEMBERS_company_id_fkey" FOREIGN KEY (company_id)
    REFERENCES public."COMPANY" (company_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."FLIGHT"
    ADD CONSTRAINT "FLIGHT_departure_airport_fkey" FOREIGN KEY (departure_airport)
    REFERENCES public."AIRPORTS" (airport_code) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."FLIGHT"
    ADD CONSTRAINT "FLIGHT_destination_airport_fkey" FOREIGN KEY (destination_airport)
    REFERENCES public."AIRPORTS" (airport_code) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."FLIGHT"
    ADD CONSTRAINT "FLIGHT_plane_id_fkey" FOREIGN KEY (plane_id)
    REFERENCES public."PLANES" (plane_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PLANES"
    ADD CONSTRAINT "PLANES_company_id_fkey" FOREIGN KEY (company_id)
    REFERENCES public."COMPANY" (company_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."PLANES"
    ADD CONSTRAINT "PLANES_model_id_fkey" FOREIGN KEY (model_id)
    REFERENCES public."PLANE_MODELS" (model_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."SEATS"
    ADD CONSTRAINT "SEATS_flight_id_fkey" FOREIGN KEY (flight_id)
    REFERENCES public."FLIGHT" (flight_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."TICKETS"
    ADD CONSTRAINT "TICKETS_cash_register_id_fkey" FOREIGN KEY (cash_register_id)
    REFERENCES public."CASH_REGISTERS" (cash_register_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."TICKETS"
    ADD CONSTRAINT "TICKETS_flight_id_fkey" FOREIGN KEY (flight_id)
    REFERENCES public."FLIGHT" (flight_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."TICKETS"
    ADD CONSTRAINT "TICKETS_passanger_id_fkey" FOREIGN KEY (passanger_id)
    REFERENCES public."PASSENGERS" (passenger_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."TICKETS"
    ADD CONSTRAINT "TICKETS_seat_id_fkey" FOREIGN KEY (seat_id)
    REFERENCES public."SEATS" (seat_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."TRANSIT"
    ADD CONSTRAINT "TRANSIT_arrival_flight_id_fkey" FOREIGN KEY (arrival_flight_id)
    REFERENCES public."FLIGHT" (flight_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."TRANSIT"
    ADD CONSTRAINT "TRANSIT_departure_fligh_id_fkey" FOREIGN KEY (departure_flight_id)
    REFERENCES public."FLIGHT" (flight_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;

END;
